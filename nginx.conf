worker_processes  2;

events {
    worker_connections  1024;
}

http {
    gzip on;

    upstream api {
        server api1:8080;
        server api2:8080;
    }

    proxy_cache_path /cache keys_zone=apicache:10m levels=1:2 inactive=60m use_temp_path=off;
    server {
        listen 9999;
        access_log  /dev/null;
        error_log /dev/null;

        # Doc: https://www.nginx.com/blog/nginx-caching-guide/ 
        # Example: Inspiration https://blog.alexellis.io/save-and-boost-with-nginx/
        location /pessoas {
            # proxy_cache apicache;
            
            # proxy_cache_background_update on;
            # proxy_cache_valid any 60m;
            # proxy_ignore_headers Cache-Control;

            # add_header Cache-Control "max-age=60";
            # add_header X-Proxy-Cache-Status $upstream_cache_status;
            proxy_pass http://api;
        }

        location /contagem-pessoas {
            proxy_pass http://api;
        }
    }
}